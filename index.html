<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTracker Elite - Sistema Profissional de Treinos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4B4BBE'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 text-gray-900 dark:text-white transition-all duration-500 font-sans">
    <!-- Header -->
    <header class="bg-primary text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-dumbbell text-2xl"></i>
                    <h1 class="text-2xl font-bold">FitTracker</h1>
                </div>
                <div class="text-sm">
                    <span id="currentDate"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
        <div class="container mx-auto px-4">
            <div class="flex space-x-8">
                <button class="nav-btn active py-4 px-2 border-b-2 border-primary text-primary font-medium" data-tab="dashboard">
                    <i class="fas fa-chart-line mr-2"></i>Dashboard
                </button>
                <button class="nav-btn py-4 px-2 border-b-2 border-transparent hover:border-gray-300 transition-colors" data-tab="exercises">
                    <i class="fas fa-list mr-2"></i>Exerc√≠cios
                </button>
                <button class="nav-btn py-4 px-2 border-b-2 border-transparent hover:border-gray-300 transition-colors" data-tab="workout">
                    <i class="fas fa-plus mr-2"></i>Registrar Treino
                </button>
                <button class="nav-btn py-4 px-2 border-b-2 border-transparent hover:border-gray-300 transition-colors" data-tab="analytics">
                    <i class="fas fa-chart-bar mr-2"></i>An√°lises
                </button>
                <button class="nav-btn py-4 px-2 border-b-2 border-transparent hover:border-gray-300 transition-colors" data-tab="tools">
                    <i class="fas fa-tools mr-2"></i>Ferramentas
                </button>
                <button class="nav-btn py-4 px-2 border-b-2 border-transparent hover:border-gray-300 transition-colors" data-tab="history">
                    <i class="fas fa-history mr-2"></i>Hist√≥rico
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-6">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <!-- Achievement System -->
            <div class="mb-8">
                <h3 class="text-2xl font-bold mb-4 text-gradient bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">üèÜ Sistema de Conquistas</h3>
                <div id="achievementsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <!-- Achievements will be populated here -->
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6 text-white hover:scale-105 transition-transform cursor-pointer">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100">Treinos Esta Semana</p>
                            <p class="text-3xl font-bold" id="weeklyWorkouts">0</p>
                            <p class="text-xs text-blue-200" id="weeklyChange">+0% vs semana anterior</p>
                        </div>
                        <i class="fas fa-calendar-week text-2xl text-blue-200"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-6 text-white hover:scale-105 transition-transform cursor-pointer">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100">Volume Semanal (kg)</p>
                            <p class="text-3xl font-bold" id="weeklyVolume">0</p>
                            <p class="text-xs text-green-200" id="volumeChange">+0% vs semana anterior</p>
                        </div>
                        <i class="fas fa-weight-hanging text-2xl text-green-200"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-6 text-white hover:scale-105 transition-transform cursor-pointer">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100">N√≠vel de For√ßa</p>
                            <p class="text-3xl font-bold" id="strengthLevel">Iniciante</p>
                            <p class="text-xs text-purple-200" id="strengthProgress">XP: 0/100</p>
                        </div>
                        <i class="fas fa-dumbbell text-2xl text-purple-200"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-6 text-white hover:scale-105 transition-transform cursor-pointer">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100">Streak Atual</p>
                            <p class="text-3xl font-bold" id="currentStreak">0</p>
                            <p class="text-xs text-orange-200" id="streakTarget">Meta: 7 dias</p>
                        </div>
                        <i class="fas fa-fire text-2xl text-orange-200"></i>
                    </div>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-6 text-white mb-8">
                <h3 class="text-xl font-bold mb-4">ü§ñ Insights da IA</h3>
                <div id="aiInsights" class="space-y-2">
                    <p class="text-indigo-100">Registre alguns treinos para receber insights personalizados!</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">√öltimos Treinos</h3>
                    <div id="recentWorkouts" class="space-y-3">
                        <p class="text-gray-500 dark:text-gray-400">Nenhum treino registrado ainda.</p>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Exerc√≠cios Mais Realizados</h3>
                    <div id="popularExercises" class="space-y-3">
                        <p class="text-gray-500 dark:text-gray-400">Nenhum exerc√≠cio registrado ainda.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Exercises Tab -->
        <div id="exercises" class="tab-content hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold mb-4">Base de Exerc√≠cios</h2>
                <div class="mb-4">
                    <input type="text" id="exerciseSearch" placeholder="Buscar exerc√≠cios..." 
                           class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700">
                </div>
                <div class="mb-4">
                    <select id="muscleFilter" class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                        <option value="">Todos os m√∫sculos</option>
                        <option value="peito">Peito</option>
                        <option value="costas">Costas</option>
                        <option value="ombros">Ombros</option>
                        <option value="bra√ßos">Bra√ßos</option>
                        <option value="pernas">Pernas</option>
                        <option value="core">Core</option>
                    </select>
                </div>
            </div>
            <div id="exerciseList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Exercises will be populated here -->
            </div>
        </div>

        <!-- Workout Tab -->
        <div id="workout" class="tab-content hidden">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold mb-6">Registrar Novo Treino</h2>
                
                <!-- Live Workout Timer -->
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-6 text-white mb-6">
                    <div class="text-center">
                        <h3 class="text-xl font-bold mb-4">‚è±Ô∏è Cron√¥metro de Treino Ao Vivo</h3>
                        <div class="text-6xl font-bold mb-4" id="liveTimer">00:00:00</div>
                        <div class="flex justify-center space-x-4 mb-4">
                            <button id="startWorkoutBtn" onclick="startWorkoutTimer()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                                <i class="fas fa-play mr-2"></i>Iniciar Treino
                            </button>
                            <button id="pauseWorkoutBtn" onclick="pauseWorkoutTimer()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors hidden">
                                <i class="fas fa-pause mr-2"></i>Pausar
                            </button>
                            <button id="resumeWorkoutBtn" onclick="resumeWorkoutTimer()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors hidden">
                                <i class="fas fa-play mr-2"></i>Retomar
                            </button>
                            <button id="stopWorkoutBtn" onclick="stopWorkoutTimer()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors hidden">
                                <i class="fas fa-stop mr-2"></i>Finalizar
                            </button>
                        </div>
                        <div id="workoutStatus" class="text-sm opacity-90">
                            <p id="startTimeDisplay" class="hidden">In√≠cio: <span id="startTimeText">--:--</span></p>
                            <p id="statusText">Pressione "Iniciar Treino" para come√ßar</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Exercise Timer -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                    <h3 class="text-lg font-bold mb-4">‚ö° Timer R√°pido Entre S√©ries</h3>
                    <div class="flex items-center justify-between">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-primary mb-2" id="quickTimer">0:00</div>
                            <div class="space-x-2">
                                <button onclick="startQuickTimer(30)" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">30s</button>
                                <button onclick="startQuickTimer(60)" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">1min</button>
                                <button onclick="startQuickTimer(90)" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">1:30</button>
                                <button onclick="startQuickTimer(120)" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">2min</button>
                            </div>
                        </div>
                        <div class="space-x-2">
                            <button id="quickStartBtn" onclick="toggleQuickTimer()" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded">
                                <i class="fas fa-play mr-1"></i>Iniciar
                            </button>
                            <button onclick="resetQuickTimer()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                <i class="fas fa-stop mr-1"></i>Parar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <form id="workoutForm">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Data do Treino</label>
                                <input type="date" id="workoutDate" required
                                       class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Hora de In√≠cio</label>
                                <input type="time" id="workoutStartTime" readonly
                                       class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Dura√ß√£o (autom√°tica)</label>
                                <input type="text" id="workoutDurationDisplay" readonly placeholder="Use o cron√¥metro acima"
                                       class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600">
                            </div>
                        </div>

                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4">Exerc√≠cios</h3>
                            <div id="exerciseEntries">
                                <div class="exercise-entry bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Exerc√≠cio</label>
                                            <select class="exercise-select w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-600">
                                                <option value="">Selecione...</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">S√©ries</label>
                                            <input type="number" class="sets w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" placeholder="3">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Repeti√ß√µes</label>
                                            <input type="number" class="reps w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" placeholder="12">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Peso (kg)</label>
                                            <input type="number" class="weight w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="0" step="0.5" placeholder="20">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" id="addExercise" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-plus mr-2"></i>Adicionar Exerc√≠cio
                            </button>
                        </div>

                        <div class="flex justify-end space-x-3">
                            <button type="button" id="clearForm" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                                Limpar
                            </button>
                            <button type="submit" class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg transition-colors">
                                <i class="fas fa-save mr-2"></i>Salvar Treino
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content hidden">
            <h2 class="text-3xl font-bold mb-6">An√°lises e Progress√£o</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Progresso de Peso por Semana</h3>
                    <canvas id="weightChart" width="400" height="200"></canvas>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Exerc√≠cios por Grupo Muscular</h3>
                    <canvas id="muscleChart" width="400" height="200"></canvas>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Frequ√™ncia de Treinos</h3>
                    <canvas id="frequencyChart" width="400" height="200"></canvas>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Evolu√ß√£o de Volume</h3>
                    <div id="volumeStats" class="space-y-4">
                        <!-- Volume stats will be populated here -->
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">Compara√ß√£o de Exerc√≠cios</h3>
                <div class="mb-4">
                    <select id="exerciseCompare" class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                        <option value="">Selecione um exerc√≠cio para ver evolu√ß√£o</option>
                    </select>
                </div>
                <canvas id="exerciseProgressChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Tools Tab -->
        <div id="tools" class="tab-content hidden">
            <h2 class="text-3xl font-bold mb-6">Ferramentas e Calculadoras</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- 1RM Calculator -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-calculator mr-2 text-primary"></i>
                        Calculadora 1RM
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Calcule sua repeti√ß√£o m√°xima baseada no peso e repeti√ß√µes realizadas.</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Peso utilizado (kg)</label>
                            <input type="number" id="rmWeight" step="0.5" placeholder="100" 
                                   class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Repeti√ß√µes realizadas</label>
                            <input type="number" id="rmReps" min="1" max="20" placeholder="8" 
                                   class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                        </div>
                        <button onclick="calculate1RM()" class="w-full bg-primary hover:bg-primary-dark text-white py-2 rounded-lg transition-colors">
                            Calcular 1RM
                        </button>
                        <div id="rmResult" class="hidden mt-4 p-4 bg-green-50 dark:bg-green-900 rounded-lg">
                            <p class="text-green-800 dark:text-green-200 font-medium">Sua repeti√ß√£o m√°xima estimada:</p>
                            <p class="text-2xl font-bold text-green-600 dark:text-green-400" id="rmValue">-</p>
                        </div>
                    </div>
                </div>

                <!-- BMI Calculator -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-weight mr-2 text-primary"></i>
                        Calculadora IMC
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Calcule seu √çndice de Massa Corporal.</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Peso (kg)</label>
                            <input type="number" id="bmiWeight" step="0.1" placeholder="70" 
                                   class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Altura (cm)</label>
                            <input type="number" id="bmiHeight" placeholder="175" 
                                   class="w-full px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                        </div>
                        <button onclick="calculateBMI()" class="w-full bg-primary hover:bg-primary-dark text-white py-2 rounded-lg transition-colors">
                            Calcular IMC
                        </button>
                        <div id="bmiResult" class="hidden mt-4 p-4 rounded-lg">
                            <p class="font-medium">Seu IMC:</p>
                            <p class="text-2xl font-bold" id="bmiValue">-</p>
                            <p class="text-sm" id="bmiCategory">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Rest Timer -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-stopwatch mr-2 text-primary"></i>
                        Timer de Descanso
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Cron√¥metro para intervalos entre s√©ries.</p>
                    
                    <div class="text-center space-y-4">
                        <div class="text-6xl font-bold text-primary" id="timerDisplay">0:00</div>
                        <div class="space-x-2">
                            <button onclick="setTimer(60)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">1min</button>
                            <button onclick="setTimer(90)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">1:30</button>
                            <button onclick="setTimer(120)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">2min</button>
                            <button onclick="setTimer(180)" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">3min</button>
                        </div>
                        <div class="space-x-2">
                            <button id="timerBtn" onclick="toggleTimer()" class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg">
                                <i class="fas fa-play mr-2"></i>Iniciar
                            </button>
                            <button onclick="resetTimer()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg">
                                <i class="fas fa-stop mr-2"></i>Parar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Workout Templates -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="fas fa-clipboard-list mr-2 text-primary"></i>
                        Templates de Treino
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Modelos de treino pr√©-definidos.</p>
                    
                    <div class="space-y-3">
                        <button onclick="loadTemplate('push')" class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                            <div class="font-medium">Push (Empurrar)</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Peito, Ombros, Tr√≠ceps</div>
                        </button>
                        <button onclick="loadTemplate('pull')" class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                            <div class="font-medium">Pull (Puxar)</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Costas, B√≠ceps</div>
                        </button>
                        <button onclick="loadTemplate('legs')" class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                            <div class="font-medium">Legs (Pernas)</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Quadr√≠ceps, Gl√∫teos, Panturrilhas</div>
                        </button>
                        <button onclick="loadTemplate('fullbody')" class="w-full text-left p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                            <div class="font-medium">Full Body</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Treino completo para corpo todo</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Data Export -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">
                    <i class="fas fa-download mr-2 text-primary"></i>
                    Exportar Dados
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">Baixe seus dados de treino em formato JSON para backup.</p>
                <button onclick="exportData()" class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg transition-colors">
                    <i class="fas fa-download mr-2"></i>Baixar Dados
                </button>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Hist√≥rico de Treinos</h2>
                <div class="flex space-x-2">
                    <select id="historyFilter" class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                        <option value="all">Todos os treinos</option>
                        <option value="week">√öltima semana</option>
                        <option value="month">√öltimo m√™s</option>
                        <option value="3months">√öltimos 3 meses</option>
                    </select>
                    <button onclick="deleteAllWorkouts()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-trash mr-2"></i>Limpar Hist√≥rico
                    </button>
                </div>
            </div>
            <div id="workoutHistory" class="space-y-6">
                <p class="text-gray-500 dark:text-gray-400 text-center py-8">Nenhum treino registrado ainda.</p>
            </div>
        </div>
    </div>

    <!-- Exercise Modal -->
    <div id="exerciseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modalTitle" class="text-2xl font-bold"></h3>
                    <button id="closeModal" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="modalContent">
                    <!-- Modal content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="hidden fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50">
        <i class="fas fa-check mr-2"></i>
        <span id="successText">Treino salvo com sucesso!</span>
    </div>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Data storage (in-memory since localStorage is not available)
        let workouts = [];
        let exerciseDatabase = [
            // Peito
            { name: "Supino Reto", muscle: "peito", instructions: "Deite no banco, segure a barra com pegada um pouco mais larga que os ombros. Des√ßa controladamente at√© o peito e empurre para cima." },
            { name: "Supino Inclinado", muscle: "peito", instructions: "Similar ao supino reto, mas em banco inclinado (30-45¬∞). Trabalha mais a parte superior do peitoral." },
            { name: "Flex√£o de Bra√ßo", muscle: "peito", instructions: "Em posi√ß√£o de prancha, des√ßa o corpo flexionando os bra√ßos at√© quase tocar o ch√£o, depois empurre para cima." },
            { name: "Crucifixo", muscle: "peito", instructions: "Deitado no banco, segure halteres com bra√ßos abertos. Aproxime os halteres acima do peito contraindo o peitoral." },
            
            // Costas
            { name: "Puxada na Polia Alta", muscle: "costas", instructions: "Sentado, puxe a barra em dire√ß√£o ao peito, contraindo as esc√°pulas. Retorne controladamente." },
            { name: "Remada Curvada", muscle: "costas", instructions: "Inclinado para frente, puxe a barra em dire√ß√£o ao abd√¥men, mantendo as esc√°pulas contra√≠das." },
            { name: "Barra Fixa", muscle: "costas", instructions: "Pendure na barra e puxe o corpo para cima at√© o queixo passar da barra. Des√ßa controladamente." },
            { name: "Remada Unilateral", muscle: "costas", instructions: "Apoiado no banco, puxe o halter em dire√ß√£o √† cintura, contraindo as costas." },
            
            // Ombros
            { name: "Desenvolvimento", muscle: "ombros", instructions: "Sentado ou em p√©, empurre os halteres ou barra acima da cabe√ßa. Des√ßa controladamente." },
            { name: "Eleva√ß√£o Lateral", muscle: "ombros", instructions: "Com halteres nas m√£os, eleve os bra√ßos lateralmente at√© a altura dos ombros." },
            { name: "Eleva√ß√£o Frontal", muscle: "ombros", instructions: "Eleve o halter √† frente do corpo at√© a altura dos ombros, alternando os bra√ßos." },
            { name: "Crucifixo Inverso", muscle: "ombros", instructions: "Inclinado para frente, abra os bra√ßos lateralmente contraindo a parte posterior dos ombros." },
            
            // Bra√ßos
            { name: "Rosca Direta", muscle: "bra√ßos", instructions: "Com barra ou halteres, flexione os cotovelos contraindo o b√≠ceps. Mantenha os cotovelos fixos." },
            { name: "Tr√≠ceps Testa", muscle: "bra√ßos", instructions: "Deitado, flexione apenas os antebra√ßos, levando a barra em dire√ß√£o √† testa." },
            { name: "Rosca Martelo", muscle: "bra√ßos", instructions: "Com halteres em pegada neutra, flexione os cotovelos alternadamente." },
            { name: "Tr√≠ceps Pulley", muscle: "bra√ßos", instructions: "Na polia alta, empurre a barra para baixo estendendo completamente os bra√ßos." },
            
            // Pernas
            { name: "Agachamento", muscle: "pernas", instructions: "Des√ßa flexionando joelhos e quadris como se fosse sentar, mantendo o peito ereto. Suba contraindo gl√∫teos e quadr√≠ceps." },
            { name: "Leg Press", muscle: "pernas", instructions: "No aparelho, empurre a plataforma com os p√©s, estendendo as pernas completamente." },
            { name: "Cadeira Extensora", muscle: "pernas", instructions: "Sentado, estenda as pernas contraindo o quadr√≠ceps. Retorne controladamente." },
            { name: "Mesa Flexora", muscle: "pernas", instructions: "Deitado de bru√ßos, flexione as pernas contraindo os posteriores da coxa." },
            { name: "Panturrilha em P√©", muscle: "pernas", instructions: "Na ponta dos p√©s, eleve o corpo contraindo as panturrilhas. Des√ßa controladamente." },
            
            // Core
            { name: "Abdominal Supra", muscle: "core", instructions: "Deitado, flexione o tronco contraindo o abd√¥men, sem puxar o pesco√ßo." },
            { name: "Prancha", muscle: "core", instructions: "Mantenha o corpo reto apoiado nos antebra√ßos e p√©s, contraindo core e gl√∫teos." },
            { name: "Abdominal Obl√≠quo", muscle: "core", instructions: "Deitado de lado, flexione o tronco lateralmente contraindo os obl√≠quos." },
            { name: "Mountain Climber", muscle: "core", instructions: "Em posi√ß√£o de prancha, alterne levando os joelhos em dire√ß√£o ao peito rapidamente." }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            populateExerciseSelects();
            populateExerciseList();
            updateDashboard();
            
            // Set default date to today
            document.getElementById('workoutDate').value = new Date().toISOString().split('T')[0];
        });

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = 
                now.toLocaleDateString('pt-BR', options);
        }

        // Tab navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const targetTab = this.dataset.tab;
                
                // Update active button
                document.querySelectorAll('.nav-btn').forEach(b => {
                    b.classList.remove('active', 'border-primary', 'text-primary');
                    b.classList.add('border-transparent');
                });
                this.classList.add('active', 'border-primary', 'text-primary');
                this.classList.remove('border-transparent');
                
                // Show target tab
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });
                document.getElementById(targetTab).classList.remove('hidden');
                
                // Update dashboard when switching to it
                if (targetTab === 'dashboard') {
                    updateDashboard();
                }
            });
        });

        // Populate exercise selects
        function populateExerciseSelects() {
            const selects = document.querySelectorAll('.exercise-select');
            selects.forEach(select => {
                select.innerHTML = '<option value="">Selecione...</option>';
                exerciseDatabase.forEach(exercise => {
                    const option = document.createElement('option');
                    option.value = exercise.name;
                    option.textContent = exercise.name;
                    select.appendChild(option);
                });
            });
        }

        // Populate exercise list
        function populateExerciseList() {
            const container = document.getElementById('exerciseList');
            container.innerHTML = '';
            
            exerciseDatabase.forEach(exercise => {
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer';
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold">${exercise.name}</h3>
                        <span class="bg-primary text-white px-2 py-1 rounded text-sm capitalize">${exercise.muscle}</span>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">${exercise.instructions.substring(0, 100)}...</p>
                    <button class="text-primary hover:text-primary-dark font-medium" onclick="showExerciseModal('${exercise.name}')">
                        Ver tutorial completo <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                `;
                container.appendChild(card);
            });
        }

        // Exercise search and filter
        document.getElementById('exerciseSearch').addEventListener('input', filterExercises);
        document.getElementById('muscleFilter').addEventListener('change', filterExercises);

        function filterExercises() {
            const searchTerm = document.getElementById('exerciseSearch').value.toLowerCase();
            const muscleFilter = document.getElementById('muscleFilter').value;
            
            const filtered = exerciseDatabase.filter(exercise => {
                const matchesSearch = exercise.name.toLowerCase().includes(searchTerm) ||
                                    exercise.instructions.toLowerCase().includes(searchTerm);
                const matchesMuscle = !muscleFilter || exercise.muscle === muscleFilter;
                return matchesSearch && matchesMuscle;
            });
            
            const container = document.getElementById('exerciseList');
            container.innerHTML = '';
            
            filtered.forEach(exercise => {
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow cursor-pointer';
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold">${exercise.name}</h3>
                        <span class="bg-primary text-white px-2 py-1 rounded text-sm capitalize">${exercise.muscle}</span>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">${exercise.instructions.substring(0, 100)}...</p>
                    <button class="text-primary hover:text-primary-dark font-medium" onclick="showExerciseModal('${exercise.name}')">
                        Ver tutorial completo <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                `;
                container.appendChild(card);
            });
        }

        // Show exercise modal
        function showExerciseModal(exerciseName) {
            const exercise = exerciseDatabase.find(ex => ex.name === exerciseName);
            if (!exercise) return;
            
            document.getElementById('modalTitle').textContent = exercise.name;
            document.getElementById('modalContent').innerHTML = `
                <div class="mb-4">
                    <span class="bg-primary text-white px-3 py-1 rounded-full text-sm capitalize">${exercise.muscle}</span>
                </div>
                <div class="prose dark:prose-invert max-w-none">
                    <h4 class="text-lg font-semibold mb-3">Como executar:</h4>
                    <p class="text-gray-700 dark:text-gray-300 leading-relaxed">${exercise.instructions}</p>
                </div>
            `;
            document.getElementById('exerciseModal').classList.remove('hidden');
        }

        // Close modal
        document.getElementById('closeModal').addEventListener('click', function() {
            document.getElementById('exerciseModal').classList.add('hidden');
        });

        // Add exercise entry
        document.getElementById('addExercise').addEventListener('click', function() {
            const container = document.getElementById('exerciseEntries');
            const newEntry = document.createElement('div');
            newEntry.className = 'exercise-entry bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4';
            newEntry.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <span class="font-medium">Exerc√≠cio ${container.children.length + 1}</span>
                    <button type="button" class="remove-exercise text-red-500 hover:text-red-700" onclick="removeExercise(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                    <div>
                        <label class="block text-sm font-medium mb-1">Exerc√≠cio</label>
                        <select class="exercise-select w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-600">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">S√©ries</label>
                        <input type="number" class="sets w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" placeholder="3">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Repeti√ß√µes</label>
                        <input type="number" class="reps w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" placeholder="12">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Peso (kg)</label>
                        <input type="number" class="weight w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="0" step="0.5" placeholder="20">
                    </div>
                </div>
            `;
            container.appendChild(newEntry);
            
            // Populate the new select
            const newSelect = newEntry.querySelector('.exercise-select');
            exerciseDatabase.forEach(exercise => {
                const option = document.createElement('option');
                option.value = exercise.name;
                option.textContent = exercise.name;
                newSelect.appendChild(option);
            });
        });

        function removeExercise(button) {
            button.closest('.exercise-entry').remove();
        }

        // Workout form submission
        document.getElementById('workoutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('workoutDate').value;
            const duration = parseInt(document.getElementById('workoutDuration').value);
            
            const exercises = [];
            const entries = document.querySelectorAll('.exercise-entry');
            
            entries.forEach(entry => {
                const exercise = entry.querySelector('.exercise-select').value;
                const sets = parseInt(entry.querySelector('.sets').value);
                const reps = parseInt(entry.querySelector('.reps').value);
                const weight = parseFloat(entry.querySelector('.weight').value) || 0;
                
                if (exercise && sets && reps) {
                    exercises.push({ exercise, sets, reps, weight });
                }
            });
            
            if (exercises.length === 0) {
                showCustomAlert('Adicione pelo menos um exerc√≠cio ao treino!');
                return;
            }
            
            const workout = {
                id: Date.now(),
                date,
                duration,
                exercises,
                totalWeight: exercises.reduce((sum, ex) => sum + (ex.weight * ex.sets * ex.reps), 0)
            };
            
            workouts.push(workout);
            
            showSuccessMessage('Treino salvo com sucesso!');
            clearWorkoutForm();
            updateDashboard();
            updateWorkoutHistory();
        });

        // Clear workout form
        document.getElementById('clearForm').addEventListener('click', clearWorkoutForm);

        // Update dashboard with advanced features
        function updateDashboard() {
            const now = new Date();
            const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
            const weeklyWorkouts = workouts.filter(w => new Date(w.date) >= weekStart).length;
            
            const totalWeight = workouts.reduce((sum, w) => sum + w.totalWeight, 0);
            const totalTime = workouts.reduce((sum, w) => sum + w.duration, 0);
            
            const uniqueExercises = new Set();
            workouts.forEach(w => {
                w.exercises.forEach(e => uniqueExercises.add(e.exercise));
            });
            
            document.getElementById('weeklyWorkouts').textContent = weeklyWorkouts;
            
            // Recent workouts
            const recentContainer = document.getElementById('recentWorkouts');
            const recentWorkouts = workouts.slice(-5).reverse();
            
            if (recentWorkouts.length === 0) {
                recentContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Nenhum treino registrado ainda.</p>';
            } else {
                recentContainer.innerHTML = recentWorkouts.map(workout => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                        <div>
                            <p class="font-medium">${new Date(workout.date).toLocaleDateString('pt-BR')}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${workout.exercises.length} exerc√≠cios ‚Ä¢ ${workout.duration}min</p>
                        </div>
                        <div class="text-right">
                            <p class="font-medium text-primary">${workout.totalWeight.toFixed(1)}kg</p>
                        </div>
                    </div>
                `).join('');
            }
            
            // Popular exercises
            const exerciseCount = {};
            workouts.forEach(w => {
                w.exercises.forEach(e => {
                    exerciseCount[e.exercise] = (exerciseCount[e.exercise] || 0) + 1;
                });
            });
            
            const popularContainer = document.getElementById('popularExercises');
            const sortedExercises = Object.entries(exerciseCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            if (sortedExercises.length === 0) {
                popularContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Nenhum exerc√≠cio registrado ainda.</p>';
            } else {
                popularContainer.innerHTML = sortedExercises.map(([exercise, count]) => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                        <p class="font-medium">${exercise}</p>
                        <span class="bg-primary text-white px-2 py-1 rounded text-sm">${count}x</span>
                    </div>
                `).join('');
            }
            
            // Update advanced features
            updateAdvancedDashboard();
        }



        // Show success message
        function showSuccessMessage(message) {
            document.getElementById('successText').textContent = message;
            const successEl = document.getElementById('successMessage');
            successEl.classList.remove('hidden');
            setTimeout(() => {
                successEl.classList.add('hidden');
            }, 3000);
        }

        // Timer functionality
        let timerInterval = null;
        let timerSeconds = 0;
        let isTimerRunning = false;

        function setTimer(seconds) {
            timerSeconds = seconds;
            updateTimerDisplay();
        }

        function toggleTimer() {
            if (isTimerRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            if (timerSeconds === 0) {
                timerSeconds = 120; // Default 2 minutes
            }
            
            isTimerRunning = true;
            document.getElementById('timerBtn').innerHTML = '<i class="fas fa-pause mr-2"></i>Pausar';
            
            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    resetTimer();
                    showSuccessMessage('Tempo de descanso finalizado!');
                }
            }, 1000);
        }

        function pauseTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            document.getElementById('timerBtn').innerHTML = '<i class="fas fa-play mr-2"></i>Retomar';
        }

        function resetTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            timerSeconds = 0;
            updateTimerDisplay();
            document.getElementById('timerBtn').innerHTML = '<i class="fas fa-play mr-2"></i>Iniciar';
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // 1RM Calculator
        function calculate1RM() {
            const weight = parseFloat(document.getElementById('rmWeight').value);
            const reps = parseInt(document.getElementById('rmReps').value);
            
            if (!weight || !reps || reps < 1 || reps > 20) {
                showCustomAlert('Por favor, insira valores v√°lidos (peso > 0 e repeti√ß√µes entre 1-20)');
                return;
            }
            
            // Brzycki formula: 1RM = weight √ó (36 / (37 - reps))
            const oneRM = weight * (36 / (37 - reps));
            
            document.getElementById('rmValue').textContent = `${oneRM.toFixed(1)}kg`;
            document.getElementById('rmResult').classList.remove('hidden');
        }

        // BMI Calculator
        function calculateBMI() {
            const weight = parseFloat(document.getElementById('bmiWeight').value);
            const height = parseFloat(document.getElementById('bmiHeight').value);
            
            if (!weight || !height || weight <= 0 || height <= 0) {
                showCustomAlert('Por favor, insira valores v√°lidos para peso e altura');
                return;
            }
            
            const heightInMeters = height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);
            
            let category, color;
            if (bmi < 18.5) {
                category = 'Abaixo do peso';
                color = 'text-blue-600 dark:text-blue-400';
            } else if (bmi < 25) {
                category = 'Peso normal';
                color = 'text-green-600 dark:text-green-400';
            } else if (bmi < 30) {
                category = 'Sobrepeso';
                color = 'text-yellow-600 dark:text-yellow-400';
            } else {
                category = 'Obesidade';
                color = 'text-red-600 dark:text-red-400';
            }
            
            document.getElementById('bmiValue').textContent = bmi.toFixed(1);
            document.getElementById('bmiValue').className = `text-2xl font-bold ${color}`;
            document.getElementById('bmiCategory').textContent = category;
            document.getElementById('bmiCategory').className = `text-sm ${color}`;
            document.getElementById('bmiResult').classList.remove('hidden');
            
            // Set background color based on category
            const resultDiv = document.getElementById('bmiResult');
            if (bmi < 18.5) {
                resultDiv.className = 'mt-4 p-4 bg-blue-50 dark:bg-blue-900 rounded-lg';
            } else if (bmi < 25) {
                resultDiv.className = 'mt-4 p-4 bg-green-50 dark:bg-green-900 rounded-lg';
            } else if (bmi < 30) {
                resultDiv.className = 'mt-4 p-4 bg-yellow-50 dark:bg-yellow-900 rounded-lg';
            } else {
                resultDiv.className = 'mt-4 p-4 bg-red-50 dark:bg-red-900 rounded-lg';
            }
        }

        // Workout Templates
        const workoutTemplates = {
            push: [
                { exercise: "Supino Reto", sets: 4, reps: 8, weight: 60 },
                { exercise: "Supino Inclinado", sets: 3, reps: 10, weight: 50 },
                { exercise: "Desenvolvimento", sets: 3, reps: 12, weight: 30 },
                { exercise: "Eleva√ß√£o Lateral", sets: 3, reps: 15, weight: 10 },
                { exercise: "Tr√≠ceps Pulley", sets: 3, reps: 12, weight: 25 }
            ],
            pull: [
                { exercise: "Puxada na Polia Alta", sets: 4, reps: 8, weight: 50 },
                { exercise: "Remada Curvada", sets: 3, reps: 10, weight: 40 },
                { exercise: "Barra Fixa", sets: 3, reps: 8, weight: 0 },
                { exercise: "Rosca Direta", sets: 3, reps: 12, weight: 20 },
                { exercise: "Rosca Martelo", sets: 3, reps: 12, weight: 15 }
            ],
            legs: [
                { exercise: "Agachamento", sets: 4, reps: 10, weight: 70 },
                { exercise: "Leg Press", sets: 3, reps: 12, weight: 150 },
                { exercise: "Cadeira Extensora", sets: 3, reps: 15, weight: 40 },
                { exercise: "Mesa Flexora", sets: 3, reps: 12, weight: 35 },
                { exercise: "Panturrilha em P√©", sets: 4, reps: 20, weight: 60 }
            ],
            fullbody: [
                { exercise: "Agachamento", sets: 3, reps: 10, weight: 60 },
                { exercise: "Supino Reto", sets: 3, reps: 10, weight: 50 },
                { exercise: "Puxada na Polia Alta", sets: 3, reps: 10, weight: 45 },
                { exercise: "Desenvolvimento", sets: 3, reps: 12, weight: 25 },
                { exercise: "Prancha", sets: 3, reps: 30, weight: 0 }
            ]
        };

        function loadTemplate(templateName) {
            const template = workoutTemplates[templateName];
            if (!template) return;
            
            // Switch to workout tab
            document.querySelector('[data-tab="workout"]').click();
            
            // Clear existing entries
            const container = document.getElementById('exerciseEntries');
            container.innerHTML = '';
            
            // Add template exercises
            template.forEach((exerciseData, index) => {
                const newEntry = document.createElement('div');
                newEntry.className = 'exercise-entry bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4';
                newEntry.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-medium">Exerc√≠cio ${index + 1}</span>
                        ${index > 0 ? '<button type="button" class="remove-exercise text-red-500 hover:text-red-700" onclick="removeExercise(this)"><i class="fas fa-trash"></i></button>' : ''}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Exerc√≠cio</label>
                            <select class="exercise-select w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-600">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">S√©ries</label>
                            <input type="number" class="sets w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" value="${exerciseData.sets}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Repeti√ß√µes</label>
                            <input type="number" class="reps w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" value="${exerciseData.reps}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Peso (kg)</label>
                            <input type="number" class="weight w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="0" step="0.5" value="${exerciseData.weight}">
                        </div>
                    </div>
                `;
                container.appendChild(newEntry);
                
                // Populate and select the exercise
                const newSelect = newEntry.querySelector('.exercise-select');
                exerciseDatabase.forEach(exercise => {
                    const option = document.createElement('option');
                    option.value = exercise.name;
                    option.textContent = exercise.name;
                    if (exercise.name === exerciseData.exercise) {
                        option.selected = true;
                    }
                    newSelect.appendChild(option);
                });
            });
            
            showSuccessMessage(`Template "${templateName}" carregado com sucesso!`);
        }

        // Data Export
        function exportData() {
            const data = {
                workouts: workouts,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fittracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccessMessage('Dados exportados com sucesso!');
        }

        // History Filter
        document.getElementById('historyFilter').addEventListener('change', function() {
            const filter = this.value;
            let filteredWorkouts = [...workouts];
            
            const now = new Date();
            
            switch(filter) {
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredWorkouts = workouts.filter(w => new Date(w.date) >= weekAgo);
                    break;
                case 'month':
                    const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                    filteredWorkouts = workouts.filter(w => new Date(w.date) >= monthAgo);
                    break;
                case '3months':
                    const threeMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 3, now.getDate());
                    filteredWorkouts = workouts.filter(w => new Date(w.date) >= threeMonthsAgo);
                    break;
            }
            
            displayFilteredWorkouts(filteredWorkouts);
        });

        function displayFilteredWorkouts(filteredWorkouts) {
            const container = document.getElementById('workoutHistory');
            
            if (filteredWorkouts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Nenhum treino encontrado para o per√≠odo selecionado.</p>';
                return;
            }
            
            const sortedWorkouts = filteredWorkouts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sortedWorkouts.map(workout => `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">${new Date(workout.date).toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                        <div class="text-right">
                            <p class="text-sm text-gray-600 dark:text-gray-400">Dura√ß√£o: ${workout.duration} min</p>
                            <p class="font-medium text-primary">Total: ${workout.totalWeight.toFixed(1)}kg</p>
                            <button onclick="deleteWorkout(${workout.id})" class="text-red-500 hover:text-red-700 text-sm mt-1">
                                <i class="fas fa-trash mr-1"></i>Excluir
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${workout.exercises.map(exercise => `
                            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded">
                                <h4 class="font-medium mb-2">${exercise.exercise}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    ${exercise.sets} s√©ries √ó ${exercise.reps} reps
                                    ${exercise.weight > 0 ? ` @ ${exercise.weight}kg` : ''}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Delete functions
        function deleteWorkout(workoutId) {
            showConfirmDialog('Tem certeza que deseja excluir este treino?', () => {
                workouts = workouts.filter(w => w.id !== workoutId);
                updateWorkoutHistory();
                updateDashboard();
                showSuccessMessage('Treino exclu√≠do com sucesso!');
            });
        }

        function deleteAllWorkouts() {
            if (workouts.length === 0) {
                showCustomAlert('N√£o h√° treinos para excluir.');
                return;
            }
            
            showConfirmDialog('Tem certeza que deseja excluir TODOS os treinos? Esta a√ß√£o n√£o pode ser desfeita.', () => {
                workouts = [];
                updateWorkoutHistory();
                updateDashboard();
                showSuccessMessage('Todos os treinos foram exclu√≠dos!');
            });
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">Cancelar</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" onclick="this.closest('.fixed').remove(); (${onConfirm})()">Confirmar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Analytics Charts
        let weightChart, muscleChart, frequencyChart, exerciseProgressChart;

        // Tab navigation enhancement for analytics
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const targetTab = this.dataset.tab;
                
                if (targetTab === 'analytics') {
                    setTimeout(() => {
                        updateAnalytics();
                    }, 100);
                }
            });
        });

        function updateAnalytics() {
            if (workouts.length === 0) {
                // Show empty state for charts
                updateEmptyAnalytics();
                return;
            }
            
            updateWeightChart();
            updateMuscleChart();
            updateFrequencyChart();
            updateVolumeStats();
            updateExerciseCompare();
        }

        function updateEmptyAnalytics() {
            // Destroy existing charts
            [weightChart, muscleChart, frequencyChart, exerciseProgressChart].forEach(chart => {
                if (chart) chart.destroy();
            });
            
            // Show empty message
            document.getElementById('volumeStats').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Registre alguns treinos para ver as an√°lises.</p>';
        }

        function updateWeightChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            
            // Group workouts by week
            const weeklyData = {};
            workouts.forEach(workout => {
                const date = new Date(workout.date);
                const weekStart = new Date(date.setDate(date.getDate() - date.getDay()));
                const weekKey = weekStart.toISOString().split('T')[0];
                
                if (!weeklyData[weekKey]) {
                    weeklyData[weekKey] = 0;
                }
                weeklyData[weekKey] += workout.totalWeight;
            });
            
            const labels = Object.keys(weeklyData).sort().map(date => 
                new Date(date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })
            );
            const data = Object.keys(weeklyData).sort().map(date => weeklyData[date]);
            
            if (weightChart) weightChart.destroy();
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Peso Total (kg)',
                        data: data,
                        borderColor: '#5D5CDE',
                        backgroundColor: 'rgba(93, 92, 222, 0.1)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateMuscleChart() {
            const ctx = document.getElementById('muscleChart').getContext('2d');
            
            const muscleCount = {};
            workouts.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    const exerciseData = exerciseDatabase.find(ex => ex.name === exercise.exercise);
                    if (exerciseData) {
                        const muscle = exerciseData.muscle;
                        muscleCount[muscle] = (muscleCount[muscle] || 0) + 1;
                    }
                });
            });
            
            const labels = Object.keys(muscleCount);
            const data = Object.values(muscleCount);
            const colors = ['#5D5CDE', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#06B6D4'];
            
            if (muscleChart) muscleChart.destroy();
            
            muscleChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateFrequencyChart() {
            const ctx = document.getElementById('frequencyChart').getContext('2d');
            
            // Group workouts by day of week
            const dayCount = [0, 0, 0, 0, 0, 0, 0]; // Sun to Sat
            workouts.forEach(workout => {
                const day = new Date(workout.date).getDay();
                dayCount[day]++;
            });
            
            const labels = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            
            if (frequencyChart) frequencyChart.destroy();
            
            frequencyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Treinos',
                        data: dayCount,
                        backgroundColor: '#5D5CDE',
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateVolumeStats() {
            const container = document.getElementById('volumeStats');
            
            if (workouts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Nenhum treino registrado ainda.</p>';
                return;
            }
            
            // Calculate volume stats
            const totalVolume = workouts.reduce((sum, w) => sum + w.totalWeight, 0);
            const avgVolume = totalVolume / workouts.length;
            const maxVolume = Math.max(...workouts.map(w => w.totalWeight));
            const recentVolume = workouts.slice(-5).reduce((sum, w) => sum + w.totalWeight, 0) / Math.min(5, workouts.length);
            
            container.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-2xl font-bold text-primary">${totalVolume.toFixed(1)}kg</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Volume Total</p>
                    </div>
                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-2xl font-bold text-green-600">${avgVolume.toFixed(1)}kg</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">M√©dia por Treino</p>
                    </div>
                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-2xl font-bold text-orange-600">${maxVolume.toFixed(1)}kg</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Recorde</p>
                    </div>
                    <div class="text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-2xl font-bold text-purple-600">${recentVolume.toFixed(1)}kg</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">M√©dia Recente</p>
                    </div>
                </div>
            `;
        }

        function updateExerciseCompare() {
            const select = document.getElementById('exerciseCompare');
            
            // Get unique exercises
            const exercises = new Set();
            workouts.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    exercises.add(exercise.exercise);
                });
            });
            
            // Populate select
            select.innerHTML = '<option value="">Selecione um exerc√≠cio para ver evolu√ß√£o</option>';
            Array.from(exercises).sort().forEach(exercise => {
                const option = document.createElement('option');
                option.value = exercise;
                option.textContent = exercise;
                select.appendChild(option);
            });
            
            // Add change listener
            select.onchange = function() {
                if (this.value) {
                    updateExerciseProgressChart(this.value);
                }
            };
        }

        function updateExerciseProgressChart(exerciseName) {
            const ctx = document.getElementById('exerciseProgressChart').getContext('2d');
            
            // Get exercise data over time
            const exerciseData = [];
            workouts.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    if (exercise.exercise === exerciseName) {
                        exerciseData.push({
                            date: workout.date,
                            weight: exercise.weight,
                            volume: exercise.weight * exercise.sets * exercise.reps
                        });
                    }
                });
            });
            
            // Sort by date
            exerciseData.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const labels = exerciseData.map(data => 
                new Date(data.date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' })
            );
            
            if (exerciseProgressChart) exerciseProgressChart.destroy();
            
            exerciseProgressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Peso (kg)',
                        data: exerciseData.map(data => data.weight),
                        borderColor: '#5D5CDE',
                        backgroundColor: 'rgba(93, 92, 222, 0.1)',
                        yAxisID: 'y'
                    }, {
                        label: 'Volume Total (kg)',
                        data: exerciseData.map(data => data.volume),
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `Progresso: ${exerciseName}`
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Peso (kg)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Volume (kg)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Achievement System with ultra-advanced features
        const achievements = [
            { id: 'first_workout', name: 'Primeira Jornada', description: 'Complete seu primeiro treino', icon: 'üéØ', unlocked: false, check: () => workouts.length >= 1 },
            { id: 'week_warrior', name: 'Guerreiro da Semana', description: 'Fa√ßa 5 treinos em uma semana', icon: '‚öîÔ∏è', unlocked: false, check: () => getWeeklyWorkouts() >= 5 },
            { id: 'consistency_king', name: 'Rei da Consist√™ncia', description: 'Mantenha um streak de 7 dias', icon: 'üëë', unlocked: false, check: () => getCurrentStreak() >= 7 },
            { id: 'volume_master', name: 'Mestre do Volume', description: 'Atinja 5000kg de volume total', icon: 'üí™', unlocked: false, check: () => getTotalVolume() >= 5000 },
            { id: 'exercise_explorer', name: 'Explorador de Exerc√≠cios', description: 'Fa√ßa 20 exerc√≠cios diferentes', icon: 'üó∫Ô∏è', unlocked: false, check: () => getUniqueExercises() >= 20 },
            { id: 'beast_mode', name: 'Modo Fera', description: 'Complete 50 treinos', icon: 'ü¶Å', unlocked: false, check: () => workouts.length >= 50 },
            { id: 'strength_legend', name: 'Lenda da For√ßa', description: 'Atinja n√≠vel avan√ßado de for√ßa', icon: 'üèÜ', unlocked: false, check: () => getStrengthLevel().level >= 3 },
            { id: 'marathon_mindset', name: 'Mentalidade Maratona', description: 'Acumule 1000 minutos de treino', icon: 'üèÉ', unlocked: false, check: () => getTotalTime() >= 1000 },
            { id: 'heavy_lifter', name: 'Levantador Pesado', description: 'Use 100kg+ em um exerc√≠cio', icon: 'üèãÔ∏è', unlocked: false, check: () => checkHeavyWeight() },
            { id: 'dedication_master', name: 'Mestre da Dedica√ß√£o', description: 'Streak de 30 dias', icon: 'üî•', unlocked: false, check: () => getCurrentStreak() >= 30 },
            { id: 'volume_destroyer', name: 'Destruidor de Volume', description: 'Atinja 10000kg de volume total', icon: 'üí•', unlocked: false, check: () => getTotalVolume() >= 10000 },
            { id: 'time_champion', name: 'Campe√£o do Tempo', description: 'Acumule 3000 minutos de treino', icon: '‚è±Ô∏è', unlocked: false, check: () => getTotalTime() >= 3000 }
        ];

        function checkHeavyWeight() {
            return workouts.some(workout => 
                workout.exercises.some(exercise => exercise.weight >= 100)
            );
        }

        function updateAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked && achievement.check()) {
                    achievement.unlocked = true;
                    showAchievementUnlocked(achievement);
                }
            });
            displayAchievements();
        }

        function displayAchievements() {
            const container = document.getElementById('achievementsList');
            if (!container) return;

            const unlockedAchievements = achievements.filter(a => a.unlocked);
            const lockedAchievements = achievements.filter(a => !a.unlocked);

            container.innerHTML = '';

            // Show unlocked achievements first
            unlockedAchievements.forEach(achievement => {
                const achievementEl = document.createElement('div');
                achievementEl.className = 'bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg p-4 text-white transform hover:scale-105 transition-transform animate-fade-in';
                achievementEl.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl animate-bounce-slow">${achievement.icon}</div>
                        <div>
                            <h4 class="font-bold">${achievement.name}</h4>
                            <p class="text-sm opacity-90">${achievement.description}</p>
                            <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded mt-1 inline-block">‚úì Desbloqueado</span>
                        </div>
                    </div>
                `;
                container.appendChild(achievementEl);
            });

            // Show locked achievements
            lockedAchievements.slice(0, 3).forEach(achievement => {
                const achievementEl = document.createElement('div');
                achievementEl.className = 'bg-gray-200 dark:bg-gray-700 rounded-lg p-4 opacity-60 hover:opacity-80 transition-opacity';
                achievementEl.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl grayscale">üîí</div>
                        <div>
                            <h4 class="font-bold text-gray-600 dark:text-gray-400">${achievement.name}</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-500">${achievement.description}</p>
                            <span class="text-xs bg-gray-300 dark:bg-gray-600 px-2 py-1 rounded mt-1 inline-block">Bloqueado</span>
                        </div>
                    </div>
                `;
                container.appendChild(achievementEl);
            });
        }

        function showAchievementUnlocked(achievement) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gradient-to-r from-yellow-400 to-orange-500 p-8 rounded-lg shadow-2xl max-w-sm w-full mx-4 text-center text-white transform animate-bounce">
                    <div class="text-6xl mb-4 animate-pulse-slow">${achievement.icon}</div>
                    <h3 class="text-2xl font-bold mb-2">üéâ Conquista Desbloqueada!</h3>
                    <h4 class="text-xl font-semibold mb-2">${achievement.name}</h4>
                    <p class="mb-4 opacity-90">${achievement.description}</p>
                    <button class="bg-white text-orange-500 px-6 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-colors" onclick="this.closest('.fixed').remove()">
                        Incr√≠vel! üéâ
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.remove();
                }
            }, 5000);
        }

        // Advanced Metrics Functions
        function getWeeklyWorkouts() {
            const now = new Date();
            const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
            return workouts.filter(w => new Date(w.date) >= weekStart).length;
        }

        function getCurrentStreak() {
            if (workouts.length === 0) return 0;
            
            const sortedDates = workouts.map(w => new Date(w.date)).sort((a, b) => b - a);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let streak = 0;
            let currentDate = new Date(today);
            
            for (let i = 0; i < sortedDates.length; i++) {
                const workoutDate = new Date(sortedDates[i]);
                workoutDate.setHours(0, 0, 0, 0);
                
                if (workoutDate.getTime() === currentDate.getTime()) {
                    streak++;
                    currentDate.setDate(currentDate.getDate() - 1);
                } else if (workoutDate.getTime() < currentDate.getTime()) {
                    break;
                }
            }
            
            return streak;
        }

        function getTotalVolume() {
            return workouts.reduce((sum, w) => sum + w.totalWeight, 0);
        }

        function getUniqueExercises() {
            const unique = new Set();
            workouts.forEach(w => {
                w.exercises.forEach(e => unique.add(e.exercise));
            });
            return unique.size;
        }

        function getTotalTime() {
            return workouts.reduce((sum, w) => sum + w.duration, 0);
        }

        function getStrengthLevel() {
            const totalVolume = getTotalVolume();
            const workoutCount = workouts.length;
            const uniqueExercises = getUniqueExercises();
            const avgVolume = workoutCount > 0 ? totalVolume / workoutCount : 0;
            
            // Advanced XP calculation considering multiple factors
            const xp = Math.floor(
                (totalVolume / 100) + 
                (workoutCount * 10) + 
                (uniqueExercises * 5) + 
                (avgVolume * 2) +
                (getCurrentStreak() * 3)
            );
            
            let level = 1;
            let levelName = 'Iniciante';
            
            if (xp >= 2000) { level = 5; levelName = 'Lenda'; }
            else if (xp >= 1000) { level = 4; levelName = 'Elite'; }
            else if (xp >= 500) { level = 3; levelName = 'Avan√ßado'; }
            else if (xp >= 200) { level = 2; levelName = 'Intermedi√°rio'; }
            
            const nextLevelXP = level === 1 ? 200 : level === 2 ? 500 : level === 3 ? 1000 : level === 4 ? 2000 : 5000;
            
            return { level, levelName, xp, nextLevelXP };
        }

        // AI-powered Insights with advanced analysis
        function generateAIInsights() {
            const container = document.getElementById('aiInsights');
            if (!container || workouts.length === 0) {
                container.innerHTML = '<p class="text-indigo-100">Registre alguns treinos para receber insights personalizados da IA!</p>';
                return;
            }
            
            const insights = [];
            
            // Advanced volume analysis
            const recentVolume = workouts.slice(-5).reduce((sum, w) => sum + w.totalWeight, 0) / Math.min(5, workouts.length);
            const avgVolume = getTotalVolume() / workouts.length;
            
            if (recentVolume > avgVolume * 1.3) {
                insights.push("üöÄ Impressionante! Seu volume aumentou drasticamente. Continue essa intensidade!");
            } else if (recentVolume > avgVolume * 1.2) {
                insights.push("üìà Excelente progresso no volume de treino! Voc√™ est√° evoluindo consistentemente.");
            } else if (recentVolume < avgVolume * 0.7) {
                insights.push("üìâ Volume baixo detectado. Considere intensificar os treinos ou verificar se est√° descansando adequadamente.");
            }
            
            // Advanced frequency analysis
            const weeklyFreq = getWeeklyWorkouts();
            const streak = getCurrentStreak();
            
            if (weeklyFreq >= 6) {
                insights.push("‚ö†Ô∏è Cuidado com overtraining! 6+ treinos/semana pode ser excessivo. Considere dias de descanso.");
            } else if (weeklyFreq >= 5) {
                insights.push("üî• Frequ√™ncia excepcional! Voc√™ est√° demonstrando grande dedica√ß√£o.");
            } else if (weeklyFreq >= 3) {
                insights.push("‚úÖ Boa frequ√™ncia de treinos! Mantenha essa consist√™ncia.");
            } else if (weeklyFreq < 3) {
                insights.push("‚è∞ Aumente a frequ√™ncia para 3-4 treinos semanais para melhores resultados.");
            }
            
            // Streak analysis
            if (streak >= 14) {
                insights.push("üî• Streak incr√≠vel! Voc√™ √© uma m√°quina de consist√™ncia. Cuidado para n√£o se esgotar.");
            } else if (streak >= 7) {
                insights.push("üëë Uma semana completa de treinos! Voc√™ est√° construindo h√°bitos s√≥lidos.");
            }
            
            // Advanced muscle group analysis
            const muscleCount = {};
            const recentWorkouts = workouts.slice(-10);
            recentWorkouts.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    const exerciseData = exerciseDatabase.find(ex => ex.name === exercise.exercise);
                    if (exerciseData) {
                        muscleCount[exerciseData.muscle] = (muscleCount[exerciseData.muscle] || 0) + 1;
                    }
                });
            });
            
            const muscleGroups = Object.entries(muscleCount).sort((a, b) => b[1] - a[1]);
            if (muscleGroups.length >= 2) {
                const [topMuscle, secondMuscle] = muscleGroups;
                if (topMuscle[1] > secondMuscle[1] * 2) {
                    insights.push(`‚öñÔ∏è Desequil√≠brio detectado: muito foco em ${topMuscle[0]}. Balance com mais ${secondMuscle[0]}.`);
                }
            }
            
            // Progressive overload analysis
            const exerciseProgressions = {};
            workouts.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    if (!exerciseProgressions[exercise.exercise]) {
                        exerciseProgressions[exercise.exercise] = [];
                    }
                    exerciseProgressions[exercise.exercise].push({
                        date: workout.date,
                        volume: exercise.weight * exercise.sets * exercise.reps
                    });
                });
            });
            
            let progressingExercises = 0;
            Object.values(exerciseProgressions).forEach(progression => {
                if (progression.length >= 3) {
                    progression.sort((a, b) => new Date(a.date) - new Date(b.date));
                    const recent = progression.slice(-3);
                    if (recent[2].volume > recent[0].volume) {
                        progressingExercises++;
                    }
                }
            });
            
            if (progressingExercises >= 3) {
                insights.push("üìä Sobrecarga progressiva detectada em v√°rios exerc√≠cios! Excelente metodologia.");
            } else if (progressingExercises === 0 && workouts.length >= 10) {
                insights.push("üìä Considere aplicar sobrecarga progressiva: aumente peso, s√©ries ou repeti√ß√µes gradualmente.");
            }
            
            // Recovery analysis
            const workoutDates = workouts.map(w => new Date(w.date)).sort((a, b) => b - a);
            let consecutiveDays = 0;
            for (let i = 0; i < Math.min(7, workoutDates.length - 1); i++) {
                const diffDays = (workoutDates[i] - workoutDates[i + 1]) / (1000 * 60 * 60 * 24);
                if (diffDays === 1) {
                    consecutiveDays++;
                } else {
                    break;
                }
            }
            
            if (consecutiveDays >= 5) {
                insights.push("üò¥ Voc√™ treinou 5+ dias consecutivos. Seu corpo precisa de descanso para recupera√ß√£o muscular.");
            }
            
            // Performance prediction
            if (workouts.length >= 5) {
                const volumeTrend = workouts.slice(-5).reduce((sum, w, i) => sum + w.totalWeight * (i + 1), 0);
                const baselineVolume = workouts.slice(-5).reduce((sum, w) => sum + w.totalWeight, 0);
                
                if (volumeTrend > baselineVolume * 3) {
                    insights.push("üéØ Tend√™ncia ascendente forte! Continue assim e voc√™ pode dobrar seu volume em 2 meses.");
                }
            }
            
            // Motivational insights based on achievements
            const unlockedCount = achievements.filter(a => a.unlocked).length;
            const totalAchievements = achievements.length;
            const achievementRate = (unlockedCount / totalAchievements) * 100;
            
            if (achievementRate >= 80) {
                insights.push("üèÜ Voc√™ √© uma lenda! 80%+ das conquistas desbloqueadas. Inspire outros!");
            } else if (achievementRate >= 50) {
                insights.push("üåü Metade das conquistas desbloqueadas! Voc√™ est√° no caminho da excel√™ncia.");
            }
            
            // Default insights for beginners
            if (insights.length === 0) {
                insights.push("üí° Continue registrando treinos para receber insights personalizados!");
                insights.push("üéØ Dica: Consist√™ncia √© mais importante que intensidade no in√≠cio.");
                insights.push("üìà Foque em aprender a forma correta dos exerc√≠cios antes de aumentar o peso.");
            }
            
            container.innerHTML = insights.map(insight => 
                `<p class="text-indigo-100 mb-2 animate-fade-in">${insight}</p>`
            ).join('');
        }

        // Enhanced Dashboard Updates with all advanced metrics
        function updateAdvancedDashboard() {
            // Update strength level with enhanced calculation
            const strength = getStrengthLevel();
            document.getElementById('strengthLevel').textContent = strength.levelName;
            document.getElementById('strengthProgress').textContent = `XP: ${strength.xp}/${strength.nextLevelXP}`;
            
            // Update streak with motivation
            const streak = getCurrentStreak();
            document.getElementById('currentStreak').textContent = streak;
            
            const streakTarget = document.getElementById('streakTarget');
            if (streak >= 30) {
                streakTarget.textContent = "üî• Lenda!";
                streakTarget.className = "text-xs text-orange-200 animate-pulse-slow";
            } else if (streak >= 14) {
                streakTarget.textContent = "üöÄ Incr√≠vel!";
            } else if (streak >= 7) {
                streakTarget.textContent = "üëë Uma semana!";
            } else {
                streakTarget.textContent = "Meta: 7 dias";
            }
            
            // Update weekly volume with comparison
            const weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            const weeklyVolume = workouts
                .filter(w => new Date(w.date) >= weekStart)
                .reduce((sum, w) => sum + w.totalWeight, 0);
            document.getElementById('weeklyVolume').textContent = weeklyVolume.toFixed(1);
            
            // Calculate advanced comparisons
            const prevWeekStart = new Date(weekStart);
            prevWeekStart.setDate(prevWeekStart.getDate() - 7);
            const prevWeekEnd = new Date(weekStart);
            prevWeekEnd.setDate(prevWeekEnd.getDate() - 1);
            
            const prevWeekWorkouts = workouts.filter(w => {
                const date = new Date(w.date);
                return date >= prevWeekStart && date <= prevWeekEnd;
            }).length;
            
            const prevWeekVolume = workouts
                .filter(w => {
                    const date = new Date(w.date);
                    return date >= prevWeekStart && date <= prevWeekEnd;
                })
                .reduce((sum, w) => sum + w.totalWeight, 0);
            
            const weeklyWorkouts = getWeeklyWorkouts();
            const workoutChange = prevWeekWorkouts > 0 ? 
                ((weeklyWorkouts - prevWeekWorkouts) / prevWeekWorkouts * 100).toFixed(0) : 0;
            const volumeChange = prevWeekVolume > 0 ? 
                ((weeklyVolume - prevWeekVolume) / prevWeekVolume * 100).toFixed(0) : 0;
            
            document.getElementById('weeklyChange').textContent = 
                `${workoutChange >= 0 ? '+' : ''}${workoutChange}% vs semana anterior`;
            document.getElementById('volumeChange').textContent = 
                `${volumeChange >= 0 ? '+' : ''}${volumeChange}% vs semana anterior`;
            
            // Update achievements and AI insights
            updateAchievements();
            generateAIInsights();
        }

        // Live Workout Timer System
        let workoutTimerInterval = null;
        let workoutStartTime = null;
        let workoutEndTime = null;
        let workoutPausedTime = 0;
        let workoutTotalPausedTime = 0;
        let isWorkoutRunning = false;
        let isWorkoutPaused = false;

        function startWorkoutTimer() {
            if (!isWorkoutRunning) {
                workoutStartTime = new Date();
                workoutTotalPausedTime = 0;
                isWorkoutRunning = true;
                isWorkoutPaused = false;
                
                // Update UI
                const startTimeText = workoutStartTime.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                document.getElementById('workoutStartTime').value = startTimeText;
                document.getElementById('startTimeText').textContent = startTimeText;
                document.getElementById('startTimeDisplay').classList.remove('hidden');
                document.getElementById('statusText').textContent = 'Treino em andamento...';
                
                // Show/hide buttons
                document.getElementById('startWorkoutBtn').classList.add('hidden');
                document.getElementById('pauseWorkoutBtn').classList.remove('hidden');
                document.getElementById('stopWorkoutBtn').classList.remove('hidden');
                
                // Start live timer
                workoutTimerInterval = setInterval(updateLiveTimer, 1000);
                
                showSuccessMessage('Treino iniciado! Boa sorte! üí™');
            }
        }

        function pauseWorkoutTimer() {
            if (isWorkoutRunning && !isWorkoutPaused) {
                workoutPausedTime = new Date();
                isWorkoutPaused = true;
                clearInterval(workoutTimerInterval);
                
                // Update UI
                document.getElementById('statusText').textContent = 'Treino pausado - Descanse um pouco!';
                document.getElementById('pauseWorkoutBtn').classList.add('hidden');
                document.getElementById('resumeWorkoutBtn').classList.remove('hidden');
                
                showSuccessMessage('Treino pausado. Hidrate-se! üíß');
            }
        }

        function resumeWorkoutTimer() {
            if (isWorkoutRunning && isWorkoutPaused) {
                workoutTotalPausedTime += new Date() - workoutPausedTime;
                isWorkoutPaused = false;
                
                // Update UI
                document.getElementById('statusText').textContent = 'Treino em andamento...';
                document.getElementById('resumeWorkoutBtn').classList.add('hidden');
                document.getElementById('pauseWorkoutBtn').classList.remove('hidden');
                
                // Restart live timer
                workoutTimerInterval = setInterval(updateLiveTimer, 1000);
                
                showSuccessMessage('Treino retomado! Vamos l√°! üöÄ');
            }
        }

        function stopWorkoutTimer() {
            if (isWorkoutRunning) {
                workoutEndTime = new Date();
                if (isWorkoutPaused) {
                    workoutTotalPausedTime += workoutEndTime - workoutPausedTime;
                }
                
                const totalDuration = Math.round((workoutEndTime - workoutStartTime - workoutTotalPausedTime) / 1000 / 60);
                
                // Update UI
                document.getElementById('workoutDurationDisplay').value = `${totalDuration} minutos`;
                document.getElementById('statusText').innerHTML = `
                    <span class="text-green-400">Treino finalizado!</span><br>
                    Dura√ß√£o: ${totalDuration} min | Pausas: ${Math.round(workoutTotalPausedTime / 1000 / 60)} min
                `;
                
                // Reset timer display
                document.getElementById('liveTimer').textContent = '00:00:00';
                
                // Show/hide buttons
                document.getElementById('startWorkoutBtn').classList.remove('hidden');
                document.getElementById('pauseWorkoutBtn').classList.add('hidden');
                document.getElementById('resumeWorkoutBtn').classList.add('hidden');
                document.getElementById('stopWorkoutBtn').classList.add('hidden');
                
                // Clear interval
                clearInterval(workoutTimerInterval);
                
                // Reset state
                isWorkoutRunning = false;
                isWorkoutPaused = false;
                
                showSuccessMessage(`Parab√©ns! Treino de ${totalDuration} minutos conclu√≠do! üéâ`);
            }
        }

        function updateLiveTimer() {
            if (isWorkoutRunning && !isWorkoutPaused) {
                const now = new Date();
                const elapsed = now - workoutStartTime - workoutTotalPausedTime;
                
                const hours = Math.floor(elapsed / 1000 / 60 / 60);
                const minutes = Math.floor((elapsed / 1000 / 60) % 60);
                const seconds = Math.floor((elapsed / 1000) % 60);
                
                const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('liveTimer').textContent = display;
            }
        }

        // Quick Timer for Rest Between Sets
        let quickTimerInterval = null;
        let quickTimerSeconds = 0;
        let isQuickTimerRunning = false;

        function startQuickTimer(seconds) {
            resetQuickTimer();
            quickTimerSeconds = seconds;
            updateQuickTimerDisplay();
            toggleQuickTimer();
        }

        function toggleQuickTimer() {
            if (isQuickTimerRunning) {
                pauseQuickTimer();
            } else {
                startQuickTimerCountdown();
            }
        }

        function startQuickTimerCountdown() {
            if (quickTimerSeconds === 0) {
                quickTimerSeconds = 60; // Default 1 minute
            }
            
            isQuickTimerRunning = true;
            document.getElementById('quickStartBtn').innerHTML = '<i class="fas fa-pause mr-1"></i>Pausar';
            
            quickTimerInterval = setInterval(() => {
                quickTimerSeconds--;
                updateQuickTimerDisplay();
                
                if (quickTimerSeconds <= 0) {
                    resetQuickTimer();
                    showSuccessMessage('‚è∞ Descanso finalizado! Pr√≥xima s√©rie!');
                    
                    // Play notification sound effect simulation
                    flashQuickTimer();
                }
            }, 1000);
        }

        function pauseQuickTimer() {
            isQuickTimerRunning = false;
            clearInterval(quickTimerInterval);
            document.getElementById('quickStartBtn').innerHTML = '<i class="fas fa-play mr-1"></i>Retomar';
        }

        function resetQuickTimer() {
            isQuickTimerRunning = false;
            clearInterval(quickTimerInterval);
            quickTimerSeconds = 0;
            updateQuickTimerDisplay();
            document.getElementById('quickStartBtn').innerHTML = '<i class="fas fa-play mr-1"></i>Iniciar';
        }

        function updateQuickTimerDisplay() {
            const minutes = Math.floor(quickTimerSeconds / 60);
            const seconds = quickTimerSeconds % 60;
            document.getElementById('quickTimer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function flashQuickTimer() {
            const timerDisplay = document.getElementById('quickTimer');
            let flashCount = 0;
            const flashInterval = setInterval(() => {
                timerDisplay.classList.toggle('text-red-500');
                timerDisplay.classList.toggle('text-primary');
                flashCount++;
                if (flashCount >= 6) {
                    clearInterval(flashInterval);
                    timerDisplay.classList.remove('text-red-500');
                    timerDisplay.classList.add('text-primary');
                }
            }, 300);
        }

        // Enhanced Workout Form Submission with Timer Data
        document.getElementById('workoutForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const date = document.getElementById('workoutDate').value;
            let duration;
            
            // Get duration from timer or manual input
            const durationDisplay = document.getElementById('workoutDurationDisplay').value;
            if (durationDisplay && durationDisplay.includes('minutos')) {
                duration = parseInt(durationDisplay.split(' ')[0]);
            } else {
                showCustomAlert('Por favor, use o cron√¥metro para cronometrar seu treino!');
                return;
            }
            
            const exercises = [];
            const entries = document.querySelectorAll('.exercise-entry');
            
            entries.forEach(entry => {
                const exercise = entry.querySelector('.exercise-select').value;
                const sets = parseInt(entry.querySelector('.sets').value);
                const reps = parseInt(entry.querySelector('.reps').value);
                const weight = parseFloat(entry.querySelector('.weight').value) || 0;
                
                if (exercise && sets && reps) {
                    exercises.push({ exercise, sets, reps, weight });
                }
            });
            
            if (exercises.length === 0) {
                showCustomAlert('Adicione pelo menos um exerc√≠cio ao treino!');
                return;
            }
            
            const workout = {
                id: Date.now(),
                date,
                duration,
                startTime: workoutStartTime ? workoutStartTime.toISOString() : null,
                endTime: workoutEndTime ? workoutEndTime.toISOString() : null,
                pausedTime: Math.round(workoutTotalPausedTime / 1000 / 60), // em minutos
                exercises,
                totalWeight: exercises.reduce((sum, ex) => sum + (ex.weight * ex.sets * ex.reps), 0)
            };
            
            workouts.push(workout);
            
            showSuccessMessage('Treino salvo com sucesso! Parab√©ns pelo esfor√ßo! üèÜ');
            clearWorkoutForm();
            updateDashboard();
            updateWorkoutHistory();
            
            // Reset workout timer state
            resetWorkoutTimerState();
        });

        function resetWorkoutTimerState() {
            workoutStartTime = null;
            workoutEndTime = null;
            workoutPausedTime = 0;
            workoutTotalPausedTime = 0;
            isWorkoutRunning = false;
            isWorkoutPaused = false;
            
            // Reset UI
            document.getElementById('liveTimer').textContent = '00:00:00';
            document.getElementById('workoutStartTime').value = '';
            document.getElementById('workoutDurationDisplay').value = '';
            document.getElementById('startTimeDisplay').classList.add('hidden');
            document.getElementById('statusText').textContent = 'Pressione "Iniciar Treino" para come√ßar';
            
            document.getElementById('startWorkoutBtn').classList.remove('hidden');
            document.getElementById('pauseWorkoutBtn').classList.add('hidden');
            document.getElementById('resumeWorkoutBtn').classList.add('hidden');
            document.getElementById('stopWorkoutBtn').classList.add('hidden');
            
            clearInterval(workoutTimerInterval);
        }

        // Enhanced Clear Form Function
        function clearWorkoutForm() {
            document.getElementById('workoutForm').reset();
            document.getElementById('workoutDate').value = new Date().toISOString().split('T')[0];
            
            const container = document.getElementById('exerciseEntries');
            container.innerHTML = `
                <div class="exercise-entry bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Exerc√≠cio</label>
                            <select class="exercise-select w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-600">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">S√©ries</label>
                            <input type="number" class="sets w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" placeholder="3">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Repeti√ß√µes</label>
                            <input type="number" class="reps w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="1" placeholder="12">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Peso (kg)</label>
                            <input type="number" class="weight w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" min="0" step="0.5" placeholder="20">
                        </div>
                    </div>
                </div>
            `;
            populateExerciseSelects();
            resetWorkoutTimerState();
        }

        // Enhanced Workout History with Time Details
        function updateWorkoutHistory() {
            const container = document.getElementById('workoutHistory');
            
            if (workouts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Nenhum treino registrado ainda.</p>';
                return;
            }
            
            const sortedWorkouts = workouts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sortedWorkouts.map(workout => {
                const workoutDate = new Date(workout.date);
                const startTime = workout.startTime ? new Date(workout.startTime).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }) : 'N/A';
                const endTime = workout.endTime ? new Date(workout.endTime).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }) : 'N/A';
                const pausedTime = workout.pausedTime || 0;
                
                return `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">${workoutDate.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                        <div class="text-right">
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                ${startTime !== 'N/A' ? `${startTime} - ${endTime}` : 'Hor√°rio n√£o registrado'}
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Dura√ß√£o: ${workout.duration} min ${pausedTime > 0 ? `(${pausedTime} min pausado)` : ''}
                            </p>
                            <p class="font-medium text-primary">Volume: ${workout.totalWeight.toFixed(1)}kg</p>
                            <button onclick="deleteWorkout(${workout.id})" class="text-red-500 hover:text-red-700 text-sm mt-1">
                                <i class="fas fa-trash mr-1"></i>Excluir
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${workout.exercises.map(exercise => `
                            <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <h4 class="font-medium mb-2">${exercise.exercise}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    ${exercise.sets} s√©ries √ó ${exercise.reps} reps
                                    ${exercise.weight > 0 ? ` @ ${exercise.weight}kg` : ''}
                                </p>
                                <p class="text-xs text-primary mt-1">
                                    Volume: ${(exercise.weight * exercise.sets * exercise.reps).toFixed(1)}kg
                                </p>
                            </div>
                        `).join('')}
                    </div>
                    ${workout.startTime ? `
                        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">In√≠cio</p>
                                    <p class="font-medium">${startTime}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Fim</p>
                                    <p class="font-medium">${endTime}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Dura√ß√£o Efetiva</p>
                                    <p class="font-medium text-green-600">${workout.duration - pausedTime} min</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">Intensidade</p>
                                    <p class="font-medium text-primary">${(workout.totalWeight / workout.duration).toFixed(1)} kg/min</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            }).join('');
        }

        // Custom alert function
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4 animate-slide-up">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded transition-colors" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>
